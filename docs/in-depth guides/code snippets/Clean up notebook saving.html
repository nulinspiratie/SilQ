

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Clean up notebook saving &mdash; SilQ 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/silq_icon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Future work" href="../../../specifications/index.html" />
    <link rel="prev" title="Code snippets" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> SilQ
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../What is SilQ.html">What is SilQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Brief QCoDeS guide.html">Brief QCoDeS guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Concepts in SilQ.html">Concepts in SilQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../For developers.html">For developers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">In-depth guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Parameter guide.html">Parameter guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ParameterNode guide.html">ParameterNode guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Data plotting guide.html">Data plotting guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Pulses and PulseSequences.html">Pulses and PulseSequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Experiment folder guide.html">Experiment folder guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../InstrumentInterface guidelines.html">InstrumentInterface guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Saving traces.html">Saving traces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Storing PulseSequences.html">Storing PulseSequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Analysis notebook guidelines.html">Analysis notebook guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Creating IPython Widgets.html">Creating IPython Widgets (IPywidgets)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Code snippets</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Clean up notebook saving</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#future-guides">Future guides</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../specifications/index.html">Future work</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Classes and functions index.html">Classes and functions index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SilQ</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">In-depth guides</a> &raquo;</li>
        
          <li><a href="index.html">Code snippets</a> &raquo;</li>
        
      <li>Clean up notebook saving</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/docs/in-depth guides/code snippets/Clean up notebook saving.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="clean-up-notebook-saving">
<h1>Clean up notebook saving<a class="headerlink" href="#clean-up-notebook-saving" title="Permalink to this headline">Â¶</a></h1>
<p>When saving a notebook, a lot of extra code is generated resulting from
interactive matplotlib plots. Every interactive figure saves ~600 lines of
unnecessary code. The following snippet strips off any matplotlib output
(excluding figures). Furthermore, Additionally, outputs consisting of
matplotlib or MatPlot objects are also stripped (these may arise if the last
function in a cell returns the figure object).</p>
<p>Place the following snippet in the jupyter notebook config file (~/
.jupyter/jupyter_notebook_config.py). The best to place it is as a
replacement of the pre-existing line <code class="docutils literal notranslate"><span class="pre">c.ContentsManager.pre_save_hook</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scrub_output_pre_save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;scrub output before saving notebooks&quot;&quot;&quot;</span>
    <span class="c1"># only run on notebooks</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;scrubbing output before saving&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;notebook&#39;</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># only run on nbformat v4</span>
    <span class="k">if</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">][</span><span class="s1">&#39;nbformat&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">][</span><span class="s1">&#39;cells&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;code&#39;</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Remove</span>
        <span class="n">filtered_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]:</span>
            <span class="n">javascript_output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;application/javascript&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">plain_output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;Put everything inside the global mpl namespace&#39;</span> <span class="ow">in</span> <span class="n">javascript_output</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">plain_output</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&lt;qcodes.plots.qcmatplotlib.MatPlot&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">plain_output</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&lt;matplotlib.&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filtered_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_outputs</span>
        <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;execution_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">c</span><span class="o">.</span><span class="n">ContentsManager</span><span class="o">.</span><span class="n">pre_save_hook</span> <span class="o">=</span> <span class="n">scrub_output_pre_save</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../../specifications/index.html" class="btn btn-neutral float-right" title="Future work" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Code snippets" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Serwan Asaad, Mark Johnson

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>